<html>
    <head>
        <title>{{- title -}}</title>
        <script src="/static/jquery-2.0.3.min.js"></script>
    </head>
    <body>
        <div class="menu">
            <a href="#" onClick="javascript:$( '.hostscontainer' ).fadeToggle()">Show Hosts</a> || 
            <a href="#" onClick="$('.envsdata').remove();$( '.envscontainer' ).fadeToggle()">Show Environments</a>
        </div>

        <div class="envscontainer">
            <ul class="envs"></ul>
            <ul class="envsdata"></ul>
        </div>

        <div class="hostscontainer">
            <ul class="hosts"></ul>
        </div>

        <div class="statscontainer">
            <p class="stats"></p>
        </div>

        <script>
            // Hide!
            $( '.hostscontainer' ).hide();
            $( '.envscontainer' ).hide();
            $( '.statscontainer' ).hide();

            var hosts = {};
            // Get the host list from the hosts local endpoint
            $.getJSON('/hosts.json', function(data) {
                $.each(data, function(key, value) {
                    hosts[key] = value;
                    $( '.hosts' ).append( $( '<li>' ).append(
                        '<a href="#" onClick="load_stats(\''+key+'\')">'+key+'</a>'));
                });
            });
            // Get the envs list from the envs local endpoint
            $.getJSON('/envs.json', function(data) {
                $.each(data, function(index, value) {
                    $( '.envs' ).append( $( '<li>' ).append(
                        '<a href="#" onClick="show_env_hosts(\''+value+'\')">'+value+'</a>'));
                });
            });

            load_stats = function(host) {
                $( '.statscontainer' ).hide();
                $( '.stats' ).remove();
                $( '.statscontainer' ).append( $('<p class="stats"></p>'));
                $.getJSON('/host/' + host + '.json', function(data) {
                    $.each(data, function(key, value) {
                        $( '.stats' ).append('<div class="stat_'+key+'"><h2>'+key+'</h2></div>');
                        $.each(value, function(ikey, ivalue) {
                            $( '.stat_'+key ).append('<b>'+ikey+'</b>: '+ivalue+'<br/>');
                        });
                    });
                });
                $( '.statscontainer' ).fadeIn();
            };

            show_env_hosts = function(env) {
                $('.envscontainer').hide();
                $('.envsdata').remove();
                $('.envscontainer').append('<ul class="envsdata"></ul>');
                $.each(hosts, function(key, value) {
                    if (value == env) {
                        $('.envsdata').append(
                            '<li><a href="#" onClick="load_stats(\''+key+'\')"><b>'+env+'</b>: '+key+'</a></li>');
                    }
                });
                $('.envscontainer').fadeIn();
            };
        </script>
    </body>
</html>
